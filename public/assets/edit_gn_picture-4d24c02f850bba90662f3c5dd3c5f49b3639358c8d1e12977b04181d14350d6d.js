var img=new Image,flg=!0,flg2=!1,first_x=null,first_y=null,last_x=null,last_y=null,base1=null,data=null;img.crossOrigin="anonymous",img.src=gon.picture+"?"+(new Date).getTime();var canvas=document.getElementById("screen_image");if(canvas&&canvas.getContext){var ctx=canvas.getContext("2d");img.onload=function(){ctx.drawImage(img,0,0,300,300*img.height/img.width),document.getElementById("custom_image").value="",canvas.addEventListener("click",first_click,!1),canvas.addEventListener("click",fill_rect,!1)};var first_click=function(t){var a=t.target.getBoundingClientRect();flg?(first_x=t.clientX-a.left,first_y=t.clientY-a.top,flg=!1):(last_x=t.clientX-a.left,last_y=t.clientY-a.top,flg=!0,flg2=!0)},fill_rect=function(){$('meta[name = "csrf-token"]').attr("content");!0===flg2&&(first_x>last_x&&([first_x,last_x]=[last_x,first_x]),first_y>last_y&&([first_y,last_y]=[last_y,first_y]),ctx.fillStyle="rgb(0, 0, 0)",ctx.fillRect(first_x,first_y,last_x-first_x,last_y-first_y),flg2=!1,data=canvas.toDataURL("image/png"),document.getElementById("custom_image").value=data)}}